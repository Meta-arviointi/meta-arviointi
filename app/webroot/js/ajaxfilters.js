/* Generated by CoffeeHelper at 2013-03-04 03:16:39 */

// Generated by CoffeeScript PHP 1.3.1
(function() {

  (function($) {
    return $.fn.ajaxfilters = function(settings) {
      var defaults;
      defaults = {
        callback: null
      };
      settings = $.extend({}, defaults, settings);
      $.param.fragment.noEscape("[],");
      return this.each(function() {
        var forms, getInputParams, id, inputs, pushParams, table, tbody, updateTable;
        table = $(this);
        id = table.attr('id');
        tbody = table.children('tbody');
        forms = $('*[data-target="' + id + '"]');
        inputs = forms.find('input, select');
        getInputParams = function() {
          var $i, i, params, val, _i, _len;
          params = {};
          for (_i = 0, _len = inputs.length; _i < _len; _i++) {
            i = inputs[_i];
            $i = $(i);
            val = $i.val();
            if ($i.attr('type') !== 'checkbox' || $i.is(':checked')) {
              console.log(i);
              console.log(val);
              if (val !== '') {
                params[$i.attr('name')] = val;
              }
            }
          }
          return params;
        };
        pushParams = function(mergeMode) {
          var params, state;
          state = {};
          params = getInputParams();
          state[id] = params;
          $.bbq.pushState(state, mergeMode);
        };
        inputs.change(function() {
          return pushParams(0);
        });
        pushParams(1);
        updateTable = function() {
          var key, state, val;
          state = $.bbq.getState(id);
          for (key in state) {
            val = state[key];
            forms.find('select[name=' + key + ']').val(val);
          }
          return tbody.children('tr').each(function() {
            var key, show, val;
            show = true;
            for (key in state) {
              val = state[key];
              if (val !== '' && $(this).attr('data-' + key) !== val) {
                show = false;
              }
            }
            return $(this).toggle(show);
          });
        };
        $(window).bind('hashchange', function(e) {
          return updateTable();
        });
        return updateTable();
      });
    };
  })(jQuery);

}).call(this);
